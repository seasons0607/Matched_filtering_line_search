# Matched_filtering_line_search
- ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€Matched filtering line searchæ³• ([Miyazaki et al. 2016, PASJ, 68, 100](https://academic.oup.com/pasj/article/68/6/100/2664382?login=true)) ã‚’ç”¨ã„ã¦ã€è¼ç·š/å¸åç·šã®æ¤œå‡ºã®æœ‰æ„æ€§ã‚’æ¤œè¨¼ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã™ã€‚
- æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨ã„ã¦è«–æ–‡ã‚’åŸ·ç­†ã™ã‚‹å ´åˆã¯ã€[Miyazaki et al. 2016, PASJ, 68, 100](https://academic.oup.com/pasj/article/68/6/100/2664382?login=true)ã¨Inoue et al., 2024, MNRAS, ??, ?? ã‚’å¼•ç”¨ã—ã¦ãã ã•ã„ã€‚
- ãƒã‚°ç­‰ã‚’è¦‹ã¤ã‘ãŸã‚‰ã€ãŠæ°—è»½ã«ã”é€£çµ¡ãã ã•ã„ã€‚
--  ğŸ“§ inoue *at* cr.scphys.kyoto-u.ac.jp

## How to use
1. å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«
   1. è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã—ãŸã‚‚ã®ã€‚
   2. è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚£ãƒƒãƒˆã™ã‚‹éš›ã«ç”¨ã„ã‚‹rmfã€arfãƒ•ã‚¡ã‚¤ãƒ«ã€‚
   3. è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã®continuumã®ã¿ã‚’ãƒ•ã‚£ãƒƒãƒˆã—ã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã—ãŸã‚‚ã®ã€‚
   4. è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ã®continuumã®ã¿ã‚’ãƒ•ã‚£ãƒƒãƒˆã—ãŸéš›ã®ã€xcmãƒ•ã‚¡ã‚¤ãƒ«ã€‚


   ã‚’ç”¨æ„ã—ã¾ã™ã€‚
2. main é–¢æ•°
3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
   
>[!WARNING]
>æœ¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®`calc_fwhm`é–¢æ•°ã¯ã€NICERã®rmfãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚åˆ¥ã®è¡›æ˜Ÿã®rmfãƒ•ã‚¡ã‚¤ãƒ«ã«ç”¨ã„ã‚‹éš›ã«ã¯ã€ãã®è¡›æ˜Ÿã®rmfãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ç”¨ã«æ›¸ãæ›ãˆãŒå¿…è¦ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€FWHMã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¾å­˜æ€§ã‚‚ã€NICER/ã™ã–ãã®å ´åˆã«ã¯3æ¬¡ã®å¤šé …å¼ã§è¿‘ä¼¼ã§ãã¾ã™ãŒã€åˆ¥ã®è¡›æ˜Ÿã§ã¯ã‚ˆã‚Šé«˜æ¬¡ã®å¼ãŒå¿…è¦ãªå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## Example 
ä½¿ç”¨ä¾‹ã¨ã—ã¦ã€NICERã«ã‚ˆã‚Šè¦³æ¸¬ã•ã‚ŒãŸRS CVnå‹é€£æ˜ŸUX Ariã®è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã«ã€æœ¬æ‰‹æ³•ã‚’ç”¨ã„ã¾ã™ã€‚
1. ã¾ãšå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’æƒãˆã¾ã™ã€‚
   1. è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã€‚æœ¬èª¿æŸ»ã§ã¯é‰„è¼ç·šã®æœ‰ç„¡ã‚’èª¿ã¹ãŸã„ã®ã§ã€ãã®å‘¨è¾ºã®ãƒãƒ³ãƒ‰ (5-8 keV) ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ç”¨ã„ã¾ã™ã€‚
      ```
      data observed_spectrum.pi
      response observed_spectrum.rmf
      arf observed_spectrum.arf
      back observed_spectrum_3C50_bkg.pi
      ignore **-5.0 8.0-**
      iplot
      wd observed_spectrum.txt
      ```
   
   2. è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ã®Continuumã®ã¿ã‚’ãƒ•ã‚£ãƒƒãƒˆã€‚æœ¬ä¾‹ã§ã¯ã€é‰„è¼ç·šã‚’é™¤ã„ãŸ5.0-6.2ã€7.2-8.0 keVã‚’`bremss`ãƒ¢ãƒ‡ãƒ«ã§ãƒ•ã‚£ãƒƒãƒˆã—ã¦ã„ã¾ã™ã€‚
      ```
      data observed_spectrum.pi
      response observed_spectrum.rmf
      arf observed_spectrum.arf
      back observed_spectrum_3C50_bkg.pi
      ignore **-5.0 8.0-**
      ignore 6.2-7.2
      model bremss
      6.0
      0.1
      renorm
      fit
      ```
      ãƒ•ã‚£ãƒƒãƒˆã‚’å®Œäº†ã—ãŸã‚‰ã€xcmãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦æœ¬ãƒ¢ãƒ‡ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ã€‚
      ```
      save all continuum.xcm
      ```
      ãã®å¾Œã€continuumã®ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã—ã¾ã™ã€‚ã“ã®éš›ã€è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ã¨Continuumã®ãƒ¢ãƒ‡ãƒ«ã®é–“ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ãƒ“ãƒ³æ•°ã‚’æƒãˆã‚‹ãŸã‚ã«ã€ãƒ•ã‚£ãƒƒãƒˆã«ç”¨ã„ãªã‹ã£ãŸ6.2-7.2 keVã®ãƒ¢ãƒ‡ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯å«ã‚ã¾ã™ã€‚
      ```
      notice all
      ignore **-5.0 8.0-**
      iplot
      wd continuum.txt
      ```
      ã“ã‚Œã§ã€ä¸‹æº–å‚™ã¯å®Œäº†ã§ã™ã€‚ã“ã®éç¨‹ã§ç”Ÿæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨ã¦ã€è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã‚„rmfãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ã„ã¦ãã ã•ã„ã€‚

> [!NOTE]
> æœ¬æ‰‹æ³•ã¯Continuumã®ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚£ãƒƒãƒˆãŒååˆ†ãªç²¾åº¦ã§å¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒå‰æã®ãŸã‚ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒãƒ³ãƒ‰ã¯å¯¾è±¡ã¨ã™ã‚‹è¼ç·šã®Â±æ•°keVã®ç‹­å¸¯åŸŸã«çµã£ãŸæ–¹ãŒè‰¯ã„å ´åˆãŒå¤šã„ã§ã™ã€‚
2. mainé–¢æ•°ã®ä¸­ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åŸ‹ã‚ã¦ã„ãã¾ã™ã€‚ã¾ãšã¯ã€rmfãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã€1.ã§ä½œæˆã—ãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®pathã‚’è¨˜å…¥ã—ã¾ã™ã€‚
      ```  
      nicer_rmf_path = "/Desktop/UX_Ari/1100380108/analysis/spec/block012/observed_spectrum.rmf"
      nicer_arf_path = "/Desktop/UX_Ari/1100380108/analysis/spec/block012/observed_spectrum.arf"
      nicer_spectrum_txt_path = "/Desktop/UX_Ari/1100380108/analysis/spec/block012/observed_spectrum.txt"
      nicer_continuum_txt_path = "/Desktop/UX_Ari/1100380108/analysis/spec/block012/continuum.txt"
      nicer_continuum_xcm_path = "/Desktop/UX_Ari/1100380108/analysis/spec/block012/continuum.xcm"
      ```
      Exposureã¯ã€è¦³æ¸¬ã•ã‚ŒãŸã‚¹ãƒšã‚¯ãƒˆãƒ«ã¨åŒã˜å€¤ã«è¨­å®šã—ã¾ã™ã€‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è©¦è¡Œå›æ•°ã¯`N=10000`ç¨‹åº¦ã¯æœ€ä½ã§ã‚‚å¿…è¦ã§ã™ã€‚
      ``` 
      exposure = 3345
      trial_number = 10000
      ```
      æœ€å¾Œã«ã€1.(i)ã§è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã™ã‚‹éš›ã«æŒ‡å®šã—ãŸã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒãƒ³ãƒ‰ã®ä¸‹é™å€¤ã¨ä¸Šé™å€¤ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
      ``` 
      continuum_energy_low = "5.0" #keV
      continuum_energy_upp = "8.0" # keV
      ```
3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
      ```
      python matched_filtering_line_search.py
      ```
   ã™ã‚‹ã¨ã€ã¾ãšã¯`calc_fwhm`é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®éš›ã€é€²è¡ŒçŠ¶æ³ãŒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚NICERã®å ´åˆã¯ã€ï¼‘åˆ†ã»ã©ã§çµ‚äº†ã—ã¾ã™ã€‚
      ```
      Calculating FWHM of 1100380108_block012.rmf:  17%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                      | 75/450 [00:09<00:47,  7.87it/s]
      ```
ã€€ã€€è¨ˆç®—ãŒå®Œäº†ã™ã‚‹ã¨ã€FWHMã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¾å­˜æ€§ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
   ![1100380108_block012_FWHM.pdf](https://github.com/user-attachments/files/17374898/1100380108_block012_FWHM.pdf)

  ãã®å¾Œã€`plot_spectrum_with_MC`é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã¾ãšã¯ã€fakeã‚¹ãƒšã‚¯ãƒˆãƒ«ã®ä½œæˆãŒé–‹å§‹ã—ã€ã“ã®éš›ã‚‚é€²è¡ŒçŠ¶æ³ãŒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚`N=10000`ã®å ´åˆã¯ã€æ•°æ™‚é–“ã»ã©ã‹ã‹ã‚Šã¾ã™ã€‚
      ```
      Generating fake spectra:  12%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                                       | 12/100 [00:40<04:59,  3.40s/it]
      ```
ã€€ã€€


5.


## Enviroment
Python 3 ã¨ 6.32 ä»¥é™ã®Heasoftã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚

## History
2024-10-04 new version 0.0 is created.

### Table of Content
[How to use](#how-to-use)
